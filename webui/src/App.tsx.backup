import ScanPage from './pages/ScanPage';
import SelectPage from './pages/SelectPage';
import ConfigPage from './pages/ConfigPage';
import MigrationPage from './pages/MigrationPage';
import { useAppStore } from './store/useAppStore';

function App() {
  const currentStep = useAppStore((state) => state.currentStep);
  const setCurrentStep = useAppStore((state) => state.setCurrentStep);
  const selectedFolders = useAppStore((state) => state.selectedFolders);
  const setSelectedFolders = useAppStore((state) => state.setSelectedFolders);
  const currentTaskId = useAppStore((state) => state.currentTaskId);
  const setCurrentTaskId = useAppStore((state) => state.setCurrentTaskId);
  const reset = useAppStore((state) => state.reset);

  const handleFoldersSelected = (folders: string[]) => {
    setSelectedFolders(folders);
    setCurrentStep('config');
  };

  const handleMigrationStarted = (id: string) => {
    setCurrentTaskId(id);
    setCurrentStep('migration');
  };

  const handleBackToScan = () => {
    reset();
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <header className="bg-white shadow">
        <div className="max-w-7xl mx-auto py-6 px-4">
          <h1 className="text-3xl font-bold text-gray-900">
            STOZ - Synology To ZimaOS Migration
          </h1>
        </div>
      </header>

      <main className="max-w-7xl mx-auto py-6 px-4">
        <div className="mb-6">
          <div className="flex items-center">
            <div className={`flex-1 ${currentStep === 'scan' ? 'text-blue-600 font-semibold' : 'text-gray-400'}`}>
              1. Scan
            </div>
            <div className={`flex-1 ${currentStep === 'select' ? 'text-blue-600 font-semibold' : 'text-gray-400'}`}>
              2. Select
            </div>
            <div className={`flex-1 ${currentStep === 'config' ? 'text-blue-600 font-semibold' : 'text-gray-400'}`}>
              3. Configure
            </div>
            <div className={`flex-1 ${currentStep === 'migration' ? 'text-blue-600 font-semibold' : 'text-gray-400'}`}>
              4. Migrate
            </div>
          </div>
          <div className="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div
              className="h-full bg-blue-600 transition-all duration-300"
              style={{
                width: currentStep === 'scan' ? '25%' : currentStep === 'select' ? '50%' : currentStep === 'config' ? '75%' : '100%'
              }}
            />
          </div>
        </div>

        {currentStep === 'scan' && <ScanPage onNext={() => setCurrentStep('select')} />}
        {currentStep === 'select' && (
          <SelectPage
            onNext={handleFoldersSelected}
            onBack={() => setCurrentStep('scan')}
          />
        )}
        {currentStep === 'config' && (
          <ConfigPage
            selectedFolders={selectedFolders}
            onNext={handleMigrationStarted}
            onBack={() => setCurrentStep('select')}
          />
        )}
        {currentStep === 'migration' && (
          <MigrationPage
            taskId={currentTaskId}
            onBack={handleBackToScan}
          />
        )}
      </main>
    </div>
  );
}

export default App;
