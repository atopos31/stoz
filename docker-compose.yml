services:
  stoz:
    image: icewhaletech/stoz:latest
    container_name: stoz
    restart: unless-stopped
    volumes:
      # Mount root filesystem as read-only to scan Synology volumes
      # For testing: use ./test:/host:ro
      # For production on Synology: use /:/host:ro
      - /:/host:ro
      # Persistent data storage
      - ./data:/data
    environment:
      # Application settings
      - GIN_MODE=release
      - SERVER_PORT=8080
      - LOG_LEVEL=info

      # Database
      - DB_PATH=/data/stoz.db

      # Scanning
      - HOST_PATH=/host
      - SCAN_CACHE_TTL=300

      # Worker configuration
      - WORKER_COUNT=3
      - CONCURRENT_FILES=3
      - CHUNK_SIZE=10485760
      - MAX_RETRIES=3

      # ZimaOS
      - ZIMAOS_TIMEOUT=30
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    # Use host network for UDP discovery to work across network interfaces
    # Access the application at http://<host-ip>:8080
    network_mode: host
